<div class="fixed inset-0 flex items-center justify-center z-50 bg-white/30 backdrop-blur-sm">
  <div class="bg-white w-full max-w-md rounded-lg p-6 shadow-lg">

    <!-- Header -->
    <div class="flex justify-between items-center mb-4">
      <h2 class="text-lg font-semibold">Add Task</h2>
      <button
        (click)="closeModal()"
        class="cursor-pointer p-2 rounded bg-gray-200 hover:bg-gray-300 text-slate-600 font-semibold">
        Ã—
      </button>
    </div>

    <!-- Form -->
    <form
      (ngSubmit)="onSubmit(form)"
      #form="ngForm"
      class="space-y-4"
      novalidate>

      <!-- Title -->
      <div>
        <input
          type="text"
          name="title"
          [(ngModel)]="formData.title"
          #title="ngModel"
          required
          minlength="3"
          maxlength="100"
          placeholder="Title"
          class="w-full border rounded p-2 outline-none focus:border-indigo-500 focus:ring-4 focus:ring-indigo-200"
          [class.border-red-500]="title.invalid && (title.dirty || title.touched || form.submitted)" />

        @if (title.invalid && (title.dirty || title.touched || form.submitted)) {
          <small class="text-red-600 block mt-1">
            @if (title.errors?.['required']) { Title is required. }
            @if (title.errors?.['minlength']) { Title must be at least 3 characters. }
            @if (title.errors?.['maxlength']) { Title must be at most 100 characters. }
          </small>
        }
      </div>

      <!-- Description -->
      <div>
        <textarea
          name="description"
          [(ngModel)]="formData.description"
          #description="ngModel"
          required
          minlength="5"
          maxlength="500"
          placeholder="Description"
          rows="4"
          class="w-full border rounded p-2 outline-none focus:border-indigo-500 focus:ring-4 focus:ring-indigo-200"
          [class.border-red-500]="description.invalid && (description.dirty || description.touched || form.submitted)">
        </textarea>

        @if (description.invalid && (description.dirty || description.touched || form.submitted)) {
          <small class="text-red-600 block mt-1">
            @if (description.errors?.['required']) { Description is required. }
            @if (description.errors?.['minlength']) { Description must be at least 5 characters. }
            @if (description.errors?.['maxlength']) { Description must be at most 500 characters. }
          </small>
        }
      </div>

      <!-- Due Date -->
      <div>
        <input
          type="date"
          name="dueDate"
          [(ngModel)]="formData.dueDate"
          #dueDate="ngModel"
          required
          [min]="todayISO"
          class="w-full border rounded p-2 outline-none focus:border-indigo-500 focus:ring-4 focus:ring-indigo-200"
          [class.border-red-500]="dueDate.invalid && (dueDate.dirty || dueDate.touched || form.submitted)" />

        @if (dueDate.invalid && (dueDate.dirty || dueDate.touched || form.submitted)) {
          <small class="text-red-600 block mt-1">
            @if (dueDate.errors?.['required']) { Due date is required. }
            @if (dueDate.errors?.['min']) { Due date must be today or in the future. }
          </small>
        }

        <p class="text-xs text-slate-500 mt-1">
          Due date must be in the future.
        </p>
      </div>

      <!-- Actions -->
      <div class="flex justify-end gap-2 pt-2">
        <button
          type="button"
          class="px-4 py-2 bg-gray-200 rounded hover:bg-gray-300"
          (click)="closeModal()">
          Cancel
        </button>

        <button
          type="submit"
          [disabled]="form.invalid"
          class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-60 disabled:cursor-not-allowed">
          Save
        </button>
      </div>

    </form>
  </div>
</div>